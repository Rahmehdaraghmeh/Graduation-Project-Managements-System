<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<location path="." inheritInChildApplications="false">
		<system.webServer>

			<!-- Handlers -->
			<handlers>
				<add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
			</handlers>

			<!-- CORS Headers -->
			<httpProtocol>
				<customHeaders>
					<add name="Access-Control-Allow-Headers" value="Authorization,Content-Type" />
					<add name="Access-Control-Allow-Origin" value="*" />
					<add name="Access-Control-Allow-Methods" value="GET,POST,PUT,PATCH,DELETE,OPTIONS" />
				</customHeaders>
			</httpProtocol>

			<!-- Rewrite to pass Authorization header -->
			<rewrite>
				<rules>
					<rule name="Pass Authorization Header" stopProcessing="true">
						<match url=".*" />
						<conditions logicalGrouping="MatchAll" />
						<serverVariables>
							<set name="HTTP_AUTHORIZATION" value="{HTTP_AUTHORIZATION}" />
						</serverVariables>
						<action type="None" />
					</rule>
				</rules>
			</rewrite>

			<!-- ASP.NET Core process -->
			<aspNetCore processPath="dotnet"
						arguments=".\GPMS.dll"
						stdoutLogEnabled="true"
						stdoutLogFile=".\logs\stdout"
						hostingModel="outofprocess" />

		</system.webServer>
	</location>
</configuration>
